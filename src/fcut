#!/bin/bash

# fcut - Move files or directories via fclip clipboard
# Usage: fcut <file_or_directory>

if [ $# -eq 0 ]; then
    echo "Usage: fcut <file_or_directory>"
    exit 1
fi

CLIPBOARD_DIR="$HOME/.fclip"
CLIPBOARD_DATA="$CLIPBOARD_DIR/data"
CLIPBOARD_INFO="$CLIPBOARD_DIR/info"
CLIPBOARD_MOVE="$CLIPBOARD_DIR/move_source"

# Create clipboard directory if it doesn't exist
mkdir -p "$CLIPBOARD_DIR"

# Get the target file/directory
TARGET="$1"

if [ ! -e "$TARGET" ]; then
    echo "Error: '$TARGET' does not exist"
    exit 1
fi

# Clear previous clipboard
rm -rf "$CLIPBOARD_DATA"
mkdir -p "$CLIPBOARD_DATA"

# Get absolute path and basename
ABS_PATH=$(realpath "$TARGET")
BASENAME=$(basename "$TARGET")

if [ -d "$TARGET" ]; then
    # Copy directory
    cp -r "$TARGET" "$CLIPBOARD_DATA/"
    echo "dir" > "$CLIPBOARD_INFO"
    echo "Moved directory '$TARGET' to clipboard (will be deleted on paste)"
else
    # Copy file
    cp "$TARGET" "$CLIPBOARD_DATA/"
    echo "file" > "$CLIPBOARD_INFO"
    echo "Moved file '$TARGET' to clipboard (will be deleted on paste)"
fi

# Store the basename and source path for move operation
echo "$BASENAME" >> "$CLIPBOARD_INFO"
echo "$ABS_PATH" > "$CLIPBOARD_MOVE"